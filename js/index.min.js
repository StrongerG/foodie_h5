function orient(){return 90==window.orientation||-90==window.orientation?($("body").attr("id","landscape"),!1):0==window.orientation||180==window.orientation?($("body").attr("id","portrait"),!1):void 0}function getQueryString(n){var o=new RegExp("(^|&)"+n+"=([^&]*)(&|$)"),e=window.location.search.substr(1).match(o);return null!=e?unescape(e[2]):null}function _isAndroid(){var n=navigator.userAgent,o=n.indexOf("Android")>-1||n.indexOf("Adr")>-1;n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return!!o}function _loadImages(n,o,e){if(e=e||n.length,n.length){var a=new Image,t=n.shift();return window._pandaImageLoadArray?window._pandaImageLoadArray=window._pandaImageLoadArray:window._pandaImageLoadArray=[],window._pandaImageLoadArray.push(t),a.src=t,_drawLoadProgress(window._pandaImageLoadArray.length/(e*e)),a.complete?(window._pandaImageLoadArray.shift(),_loadImages(n,o,e)):(a.onload=function(){window._pandaImageLoadArray.shift(),a.onload=null},a.onerror=function(){window._pandaImageLoadArray.shift(),a.onerror=null},_loadImages(n,o,e))}o&&_loadProgress(o,window._pandaImageLoadArray.length,e)}function _loadProgress(n,o,e){var a=setInterval(function(){0!=window._pandaImageLoadArray.length&&window._pandaImageLoadArray.length!=o?_drawLoadProgress((o-window._pandaImageLoadArray.length)/e):0==window._pandaImageLoadArray.length&&(_drawLoadProgress(1),setTimeout(function(){n.call(window)},500),clearInterval(a))},300)}function _drawLoadProgress(n){var o=Math.floor(100*n)>=100?100:Math.floor(100*n)+1;$("").html(o),$("").css({width:o+"%"})}function autoPlayMusic(){function n(){musicPlay(!0),document.body.removeEventListener("touchstart",n)}function o(){musicPlay(!0),document.addEventListener("WeixinJSBridgeReady",function(){musicPlay(!0)},!1),document.removeEventListener("DOMContentLoaded",o)}document.body.addEventListener("touchstart",n),document.addEventListener("DOMContentLoaded",o),n(),o()}function musicPlay(n){n&&music.paused&&music.play(),n||music.paused||music.pause()}function wxShare(shareTitle,shareDesc,link){if(!link)var link=location.href;var uri=window.location.href.split("#")[0];$.post("//h5.xhangjia.com/wxapi.php",{uri:uri},function(data){data=eval("("+data+")");var apilist=["onMenuShareTimeline","onMenuShareAppMessage"];wx.config({debug:!1,appId:data.appid,timestamp:data.timestamp,nonceStr:data.noncestr,signature:data.signature,jsApiList:apilist}),wx.ready(function(){wx.onMenuShareAppMessage({title:shareTitle,desc:shareDesc,link:link,imgUrl:"https://img.xhangjia.com/h5/2018/10/foodie/wximg.jpg",success:function(){}}),wx.onMenuShareTimeline({title:shareTitle,link:link,imgUrl:"https://img.xhangjia.com/h5/2018/10/foodie/wximg.jpg",success:function(){}})})})}document.body.addEventListener("touchmove",function(n){n.preventDefault()},{passive:!1});var Core=window.Core||{};Core.CONFIG={TwinkTime:70,TwinkCount:3,MsgTimeout:1e3},Core.Center=function(n,o){var e=$(window),a=(e.height()-n.height())/2.2+0+0,t=(e.width()-n.width())/2+0+0;a<0&&(a=0),t<0&&(t=0);var r=document.documentElement.scrollTop||document.body.scrollTop;r&&(a+=r),n.css({top:a,left:t})},Core.MinMessage=function(){var n,o,e={Type:{suc:"hint-icon hint-suc-m",war:"hint-icon hint-war-m",err:"hint-icon hint-err-m",load:"hint-loader"}},a=function(){o&&window.clearTimeout(o),n&&n.fadeOut(300)};return{Show:function(t){t.type||(t.type="war"),function(o){n||(n=$('<div class="popup-hint" style="background-color:rgba(0,0,0,0.7);border-radius:0.3rem;position:fixed;top:9999px;lefe:9999px;z-index:9999999999;display:none;"><i class="" rel="type"></i><em class="sl"><b></b></em><span class="desc" style="color:#fff;font-size: 0.8rem;padding: 0.3rem 1rem; line-height: 1.5rem; display:block;" rel="con"></span><em class="sr"><b></b></em></div>'),$(document.body).append(n)),n.find("[rel='con']").html(o.text);var a=n.find("[rel='type']");for(var t in e.Type)a.removeClass(e.Type[t]);a.addClass(e.Type[o.type]),n.fadeIn(300),Core.Center(n)}(t),o&&window.clearTimeout(o),t.timeout&&(o=window.setTimeout(a,3e3))},Hide:function(){n&&n.fadeOut(300)}}}(),function(n,o,e){n.extend(n,{alertTip:function(o,e,a){n.isNumeric(e)&&(a=e,e=null),top.window.Core&&top.window.Core.MinMessage?top.window.Core.MinMessage.Show({text:o,type:"war",window:e?{warp:e}:null,timeout:a||2e3}):alert(o)},showTip:function(n,o){top.window.Core.MinMessage.Show({text:n,type:"war",window:o?{warp:o}:null})},closeTip:function(){top.window.Core.MinMessage.Hide()}})}(jQuery,window);var localStorages={Get:function(n){if(window.localStorage&&window.localStorage.getItem&&n)return window.localStorage.getItem(n)},Set:function(n,o){if(window.localStorage&&window.localStorage.setItem&&o&&o)return window.localStorage.setItem(n,o)},Clear:function(n){n?window.localStorage.removeItem(n):window.localStorage.clear()}},cdnurl="https://img.xhangjia.com/h5/2018/10/foodie/",pics=[cdnurl+"loading.png",cdnurl+"loading-icon.png",cdnurl+"music-on.png",cdnurl+"music-off.png",cdnurl+"arrow.png",cdnurl+"background.png",cdnurl+"balloon-blue.png",cdnurl+"balloon-orange.png",cdnurl+"balloon-purple.png",cdnurl+"cat.png",cdnurl+"light.png",cdnurl+"machine.png",cdnurl+"people-EAT.png",cdnurl+"people-red.png",cdnurl+"rocker.png",cdnurl+"tip.png",cdnurl+"p2-background.png",cdnurl+"p2-btn.png",cdnurl+"p2-close.png",cdnurl+"p2-rocker-tip.png",cdnurl+"p2-rocker.png",cdnurl+"p2-selected.png",cdnurl+"p2-tableware-ceramics.png",cdnurl+"p2-tableware-silver.png",cdnurl+"p2-tableware-wood.png",cdnurl+"p2-tip.png",cdnurl+"p3-background.png",cdnurl+"p3-balloon-blue.png",cdnurl+"p3-balloon-orange.png",cdnurl+"p3-balloon-purple.png",cdnurl+"p3-bottomimg.png",cdnurl+"p3-btn.png",cdnurl+"p3-lv1.png",cdnurl+"p3-lv2.png",cdnurl+"p3-lv3.png",cdnurl+"p3-lv4.png",cdnurl+"p3-lv5.png",cdnurl+"p3-lv6.png",cdnurl+"p3-result-tip.png",cdnurl+"p3-result.png",cdnurl+"p3-rim.png",cdnurl+"p3-story-btn.png",cdnurl+"p3-story-tip.png",cdnurl+"p3-story.png",cdnurl+"p3-text.png",cdnurl+"p3-title.png",cdnurl+"ReportImg.png",cdnurl+"story-food-s-hhj.png",cdnurl+"story-food-s-hjbc.png",cdnurl+"story-food-s-hslxr.png",cdnurl+"story-food-s-jzym.png",cdnurl+"story-food-s-qtdth.png",cdnurl+"story-food-s-sfjzs.png",cdnurl+"story-food-s-tgjjrg.png",cdnurl+"story-food-s-wsgyt.png",cdnurl+"story-food-s-xbmhlm.png",cdnurl+"story-food-s-xhky.png",cdnurl+"story-food-s-ymdg.png",cdnurl+"tablewareimg-ceramics.png",cdnurl+"tablewareimg-silver.png",cdnurl+"tablewareimg-wood.png",cdnurl+"food-cf.png",cdnurl+"food-chf.png",cdnurl+"food-gqmx.png",cdnurl+"food-hmj.png",cdnurl+"food-kc.png",cdnurl+"food-klm.png",cdnurl+"food-krbf.png",cdnurl+"food-lp.png",cdnurl+"food-rgm.png",cdnurl+"food-rjm.png",cdnurl+"food-s-hhj.png",cdnurl+"food-s-hjbc.png",cdnurl+"food-s-hslxr.png",cdnurl+"food-s-jzym.png",cdnurl+"food-s-qtdth.png",cdnurl+"food-s-sfjzs.png",cdnurl+"food-s-tgjjrg.png",cdnurl+"food-s-wsgyt.png",cdnurl+"food-s-xbmhlm.png",cdnurl+"food-s-xhky.png",cdnurl+"food-s-ymdg.png",cdnurl+"food-sjb.png",cdnurl+"food-slf.png",cdnurl+"food-szb.png",cdnurl+"food-yxfs.png",cdnurl+"food-zcbf.png",cdnurl+"food-zjp.png",cdnurl+"logo-cova.png",cdnurl+"logo-hjyy.png",cdnurl+"logo-hsz.png",cdnurl+"logo-jtwe.png",cdnurl+"logo-mzdp.png",cdnurl+"logo-tg.png",cdnurl+"logo-wsg.png",cdnurl+"logo-xb.png",cdnurl+"logo-xbmh.png",cdnurl+"logo-xh.png",cdnurl+"logo-xng.png",cdnurl+"bgmusic.mp3",cdnurl+"lv1.png",cdnurl+"lv2.png",cdnurl+"lv3.png",cdnurl+"lv4.png",cdnurl+"lv5.png",cdnurl+"lv6.png"],music=document.getElementById("Music");autoPlayMusic(),$(".music_icon").on("touchstart",function(){return $(this).hasClass("mute")?($(this).removeClass("mute"),music.play()):($(this).addClass("mute"),music.pause()),!1});var OPENID=getQueryString("openid");$(function(){if(console.log(OPENID),OPENID)n="https://h5.xhangjia.com/2018/10/foodie/index.html?openid="+OPENID;else var n="https://h5.xhangjia.com/2018/10/foodie/index.html";var o="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxd950f35d1f20806a&redirect_uri="+n+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect";if(localStorages.Get("nlpUserInfo")){(a=JSON.parse(localStorages.Get("nlpUserInfo")))&&a.headimgurl?allStartFun(a):window.location.href=o}else if(getQueryString("code")){var e=getQueryString("code");$.ajax({url:"api/user.php",type:"GET",dataType:"json",data:{code:e},success:function(n){n.headimgurl?(localStorages.Set("nlpUserInfo",JSON.stringify(n)),allStartFun(n)):window.location.href=o}})}else{var a=JSON.parse(localStorages.Get("nlpUserInfo"));a&&a.headimgurl?allStartFun(a):window.location.href=o}});var allStartFun=function(n){wxShare("吃货鉴定所","快来发现你内心隐藏的吃货属性。"),_loadImages(pics,function(){console.log("加载完毕..."),$(".loading").fadeOut(800),$(".page1").fadeIn(800),setTimeout(function(){$(".music").css("animation","rotation 5s linear infinite")},700)}),$(".music").on("touchstart",function(){return $(this).hasClass("mute")?($(this).removeClass("mute"),$(".music-on").removeClass("music-off"),music.play()):($(this).addClass("mute"),$(".music-on").addClass("music-off"),music.pause()),!1}),$("#Start").bind("click",function(){$(".rocker").addClass("rocker-animation"),setTimeout(function(){$(".page1").fadeOut(1e3),$(".page2").fadeIn(1500)},300),setTimeout(function(){$(".rocker").removeClass("rocker-animation")},1300)}),$(".p2-rocker").bind("click",function(){$(".p2-rocker").css("top","5rem"),$(".p2-rocker-tip").fadeOut(300),setTimeout(function(){$(".p2-rocker").css("top","0.8rem"),$(".p2-rocker-tip").fadeIn(500)},300);var n=$(this).attr("data-number");if(n>=27)return $(this).attr("data-number",4),$(".food-list").hide(),$(".food-list:lt(4)").show(),!1;var o=parseInt(n)+4;$(this).attr("data-number",o),$(".food-list:lt("+o+")").show(),$(".food-list:lt("+n+")").hide()}),$(".p2-tableware").on("click","li",function(){var n=$(this).attr("number");$(".p2-tableware ul li .p2-tableware-inner").css("transform","scale(1)"),$(this).find(".p2-tableware-inner").css("transform","scale(1.2)"),$(".activation-tableware").attr("pid",n),"1"==n&&($(".tableware-icon").addClass("tableware-icon-ceramics"),$(".tableware-icon").addClass("tableware-icon-animation"),setTimeout(function(){$(".tableware-icon").removeClass("tableware-icon-animation")},500),$(".tableware-icon").removeClass("tableware-icon-silver"),$(".tableware-icon").removeClass("tableware-icon-wood")),"2"==n&&($(".tableware-icon").addClass("tableware-icon-silver"),$(".tableware-icon").addClass("tableware-icon-animation"),setTimeout(function(){$(".tableware-icon").removeClass("tableware-icon-animation")},500),$(".tableware-icon").removeClass("tableware-icon-ceramics"),$(".tableware-icon").removeClass("tableware-icon-wood")),"3"==n&&($(".tableware-icon").addClass("tableware-icon-wood"),$(".tableware-icon").addClass("tableware-icon-animation"),setTimeout(function(){$(".tableware-icon").removeClass("tableware-icon-animation")},500),$(".tableware-icon").removeClass("tableware-icon-ceramics"),$(".tableware-icon").removeClass("tableware-icon-silver"));var o=$(".activation-tableware .tableware-icon").css("background-image");$(".tablewareimg").css("background-image",o)}),$(function(){$(".p2-food-box ul").html(function(n){for(var o=n.length,e=n.length;e>0;e--){var a=parseInt(Math.random()*o),t=n[--o];n[o]=n[a],n[a]=t}return n}($(".food-list"))),$(".food-list:lt(4)").show()});var o=[],e=0;$(".p2-food-box").on("click","li",function(){var n=$(this).attr("data-id");if(o.length>=4)return!1;if(!function(n,o){for(var e=0;e<n.length;e++)if(o===n[e])return!0;return!1}(o,n)){$(this).find(".selected").show();var e='<li class="activation-item fdp_item" data-id="'+n+'"><div class="close"></div><div class="food-icon"><img src="'+$(this).find(".food-icon img").attr("src")+'" alt=""></div></div></li>';$(".p2-activation-box ul").append(e),o.push(n)}}),$(".p2-activation-box").on("click",".close",function(){var n=$(this).parents("li").attr("data-id");$(this).parents("li").remove();var e=o.indexOf(n);o.splice(e,1),$(".p2-food-box li[data-id="+n+"]").find(".selected").hide()});var a=!1;$("#Done").bind("click",function(){t=$(".activation-tableware").attr("pid");if(0==o.length)return $.alertTip("请先选择您喜欢的餐具和菜品"),!1;if(1==o.length||2==o.length||3==o.length||""==t)return $.alertTip("请先选择足够的餐具和菜品"),!1;$(".page2").fadeOut(1e3),$(".loading2").fadeIn(1500),setTimeout(function(){$(".loading2").fadeOut(1e3),$(".page3").fadeIn(1500),function(o){var e=spritejs.Scene,a=spritejs.Group,t=spritejs.Sprite,r=spritejs.Label,i=n.nickname,l=new e("#container",{resolution:[550,892]}).layer(),s=new a,d=$(".foodimg-big img").attr("src"),c=$(".foodimg-1 img").attr("src"),p=$(".foodimg-2 img").attr("src"),u=$(".foodimg-3 img").attr("src"),g=$(".tablewareimg img").attr("src"),m=$(".p3-story-btn").attr("scores");m<=25&&(f="https://img.xhangjia.com/h5/2018/10/foodie/lv1.png");m>=35&&m<=40&&(f="https://img.xhangjia.com/h5/2018/10/foodie/lv2.png");m>=50&&m<=65&&(f="https://img.xhangjia.com/h5/2018/10/foodie/lv3.png");m>=70&&m<=85&&(f="https://img.xhangjia.com/h5/2018/10/foodie/lv4.png");95==m&&(f="https://img.xhangjia.com/h5/2018/10/foodie/lv5.png");if(100==m)var f="https://img.xhangjia.com/h5/2018/10/foodie/lv6.png";var w=new t(f);w.attr({pos:[0,0],scale:1});var h=new r(i);h.attr({pos:[111,25],font:"bold 46px Arial",width:400,lineHeight:58,lineBreak:"none",fillColor:"#6f737a"});var v=new t(d);v.attr({size:[215,215],pos:[142,242],scale:1});var b=new t(c);b.attr({size:[88,101],pos:[52,222],scale:1});var y=new t(p);y.attr({size:[124,124],pos:[129,160],scale:1});var x=new t(u);x.attr({size:[125,125],pos:[284,160],scale:1});var C=new t(g);C.attr({size:[83,183],pos:[364,286],scale:1}),s.append(w,h,b,y,x,C,v),setTimeout(function(){l.append(s)},1500),setTimeout(function(){var n=new Image;n.src=l.canvas.toDataURL("image/jpeg",1),n.onload=function(){$("#ReportImg").attr("src",n.src)}},2e3)}()},2e3);var t;1==(t=$(".activation-tableware").attr("pid"))?e+=20:2==t?e+=15:3==t&&(e+=5),$(".p3-story-food .sf_icon_item").hide(),$(".p3-story-text .sf_text_item").hide();var r=[],i=function(n,o){switch(arguments.length){case 1:return parseInt(Math.random()*n+1,10);case 2:return parseInt(Math.random()*(o-n+1)+n,10);default:return 0}}(1,11);$(".p3-story-food .sf_icon_item[data-id="+i+"]").show(),$(".p3-story-text .sf_text_item[data-id="+i+"]").show(),$.each(o,function(n,o){console.log(n);var t=$(".p2-food-box li[data-id="+o+"]").find(".food-icon img").attr("src");console.log(t),$(".page2 .p2-food-box .food-list[data-id="+o+"]").hasClass("star")&&0==a?($(".page3 .p3-bottomimg .foodimg-big img").attr("src",t),$(".p3-story-food .sf_icon_item").hide(),$(".p3-story-text .sf_text_item").hide(),$(".p3-story-food .sf_icon_item[data-id="+o+"]").show(),$(".p3-story-text .sf_text_item[data-id="+o+"]").show(),a=!0):r.push(t),$(".p2-food-box li[data-id="+o+"]").hasClass("star")?e+=20:e+=5}),$.each(r,function(n,o){$(".page3 .fr_small_item img").eq(n).attr("src",o)}),$(".p3-story-btn").attr("scores",e);var l=$(".p3-story-btn").attr("scores");console.log(l),l<=25&&(console.log("洒脱"),$(".p3-lv1").show()),l>=35&&l<=40&&(console.log("执念"),$(".p3-lv2").show()),l>=50&&l<=65&&(console.log("反转"),$(".p3-lv3").show()),l>=70&&l<=85&&(console.log("养生"),$(".p3-lv4").show()),95==l&&(console.log("安利"),$(".p3-lv5").show()),100==l&&(console.log("精致"),$(".p3-lv6").show())}),$("#Close").bind("click",function(){$(".p3-story").addClass("story-animation"),setTimeout(function(){$(".p3-story").hide()},1e3)}),$("#Close2").bind("click",function(){$(".p3-story").addClass("story-animation"),setTimeout(function(){$(".p3-story").hide()},1e3)});var t=n.nickname;$("#UserName").html(t),$("#Reset").bind("click",function(){$(".page3").fadeOut(1e3),$(".page1").fadeIn(1500),o=[],e=0,imgArr=[],$(".p2-food-box li .selected").hide(),$(".p2-activation-box .fdp_item").remove(),$(".tableware-icon").removeClass("tableware-icon-silver"),$(".tableware-icon").removeClass("tableware-icon-wood"),$(".tableware-icon").removeClass("tableware-icon-ceramics"),$(".p2-tableware ul li .p2-tableware-inner").css("transform","scale(1)"),$(".p3-rim").find("div").hide()})};